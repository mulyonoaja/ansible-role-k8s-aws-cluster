iam_policies:
  k8s-cluster-autoscaler:
    policy_description: A managed policy for k8s cluster-autoscaler
    policy:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Action:
        - autoscaling:DescribeAutoScalingGroups
        - autoscaling:DescribeAutoScalingInstances
        - autoscaling:DescribeLaunchConfigurations
        - autoscaling:DescribeTags
        - autoscaling:SetDesiredCapacity
        - autoscaling:TerminateInstanceInAutoScalingGroup
        Resource: "*"

  k8s-external-dns:
    policy_description: A managed policy for k8s external-dns
    policy:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Action:
        - route53:ChangeResourceRecordSets
        Resource:
        - arn:aws:route53:::hostedzone/*
      - Effect: Allow
        Action:
        - route53:ListHostedZones
        - route53:ListResourceRecordSets
        Resource:
        - "*"

  k8s-aws-alb-ingress-controller:
    policy_description: A managed policy for k8s aws-alb-ingress-controller
    policy:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Action:
        - acm:DescribeCertificate
        - acm:ListCertificates
        Resource: "*"
      - Effect: Allow
        Action:
        - ec2:AuthorizeSecurityGroupIngress
        - ec2:CreateSecurityGroup
        - ec2:CreateTags
        - ec2:DeleteSecurityGroup
        - ec2:DescribeInstances
        - ec2:DescribeSecurityGroups
        - ec2:DescribeSubnets
        - ec2:DescribeTags
        - ec2:ModifyInstanceAttribute
        - ec2:RevokeSecurityGroupIngress
        Resource: "*"
      - Effect: Allow
        Action:
        - elasticloadbalancing:AddTags
        - elasticloadbalancing:CreateListener
        - elasticloadbalancing:CreateLoadBalancer
        - elasticloadbalancing:CreateRule
        - elasticloadbalancing:CreateTargetGroup
        - elasticloadbalancing:DeleteListener
        - elasticloadbalancing:DeleteLoadBalancer
        - elasticloadbalancing:DeleteRule
        - elasticloadbalancing:DeleteTargetGroup
        - elasticloadbalancing:DeregisterTargets
        - elasticloadbalancing:DescribeListeners
        - elasticloadbalancing:DescribeLoadBalancers
        - elasticloadbalancing:DescribeLoadBalancerAttributes
        - elasticloadbalancing:DescribeRules
        - elasticloadbalancing:DescribeTags
        - elasticloadbalancing:DescribeTargetGroups
        - elasticloadbalancing:DescribeTargetGroupAttributes
        - elasticloadbalancing:DescribeTargetHealth
        - elasticloadbalancing:ModifyListener
        - elasticloadbalancing:ModifyLoadBalancerAttributes
        - elasticloadbalancing:ModifyRule
        - elasticloadbalancing:ModifyTargetGroup
        - elasticloadbalancing:ModifyTargetGroupAttributes
        - elasticloadbalancing:RegisterTargets
        - elasticloadbalancing:RemoveTags
        - elasticloadbalancing:SetIpAddressType
        - elasticloadbalancing:SetSecurityGroups
        - elasticloadbalancing:SetSubnets
        - elasticloadbalancing:SetWebACL
        Resource: "*"
      - Effect: Allow
        Action:
        - iam:GetServerCertificate
        - iam:ListServerCertificates
        Resource: "*"
      - Effect: Allow
        Action:
        - waf-regional:GetWebACLForResource
        Resource: "*"
      - Effect: Allow
        Action:
        - tag:GetResources
        Resource: "*"
      - Effect: Allow
        Action:
        - waf:GetWebACL
        - waf:AssociateWebACL
        - waf:DisassociateWebACL
        Resource: "*"

  k8-cloudwatch-logs:
    policy_description: A managed policy for sending logs to cloudwatch
    policy:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Action:
        - logs:CreateLogStream
        - logs:CreateLogGroup
        - logs:PutLogEvents
        - logs:DescribeLogStreams
        Resource:
        - arn:aws:logs:*:*:log-group:*
        - arn:aws:logs:*:*:log-group:*:log-stream:*

iam_roles:
  k8s-cluster-autoscaler:
    policies:
    - k8s-cluster-autoscaler
  k8s-external-dns:
    policies:
    - k8s-external-dns
  k8s-aws-alb-ingress-controller:
    policies:
    - k8s-aws-alb-ingress-controller
  k8-cloudwatch-logs:
    policies:
    - k8-cloudwatch-logs
