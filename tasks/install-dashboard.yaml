- name: set config for dashboard
  set_fact:
    dashboard: "{{ clusterSpec.kubernetesDashboardTemplate | combine( clusterSpec.kubernetesDashboard, recursive=True ) }}"

- name: set ingress class for dashboard'
  set_fact:
    dashboard: >
      {{ dashboard | combine(
        {
          'values': {
            'ingress': {
              'enabled': true,
              'annotations': {
                'kubernetes.io/ingress.class' : dashboard.ingress.ingressClass | default('nginx-internal')
              },
              'hosts': [dashboard.ingress.hostname]
            }
          }
        }, recursive=True)
      }}
  when: "dashboard.ingress is defined and dashboard.ingress.hostname is defined and dashboard.ingress.hostname"

- name: install dashboard
  import_tasks: install-addon.yaml
  vars:
    addon: '{{ dashboard }}'
    name: 'kubernetes-dashboard'
